# 登录业务
[登录业务](./images/Login.png)

## http的无状态性
客户端的每次http请求都是独立的，连续多个请求直接是没有直接关系，服务器不会主动保留每次http请求的状态。

### 表单校验，用户密码加密
首先需要有个登录页面，采用的是element的from表单，然后加入规则校验去判断账号密码的合法性，校验通过后点击登录按钮，这时我们会像服务器发送一个携带加密后的用户密码请求。

### token(持久化,拦截器)
后端接收后经过验证，通过之后，就会给我们返回一个包含用户信息加密后带有有效期限的token字符串，这时我们会对token进行一个持久化存储，在vuex和localStorage里分别存储一份。
**为什么要存两份**vuex是存储在内存里，localStorage的读取是一次磁盘读取，读取速度远低于vuex的内存读取，但是页面刷新后vuex里数据就会消失，所有需要在本地存储一份，页面刷新后从本地存储，每次更新token也是修改vuex中的token，然后再覆盖到localStorage中。
我们拿到token后要给请求拦截器设置token，之后向后端发送的请求都会在请求头header携带上这个token。
**为什么要在请求时携带token**是为了验证请求的身份和授权信息。防止CSRF攻击(跨站请求伪造),在一个CSRF攻击中，攻击者通过伪造一个请求，将请求发送给一个已经登录的用户，并利用这个用户的身份执行某些恶意操作。为了防止这种攻击，服务器可以要求客户端在每个请求中携带一个CSRF Token。由服务器验证这个Token是否正确，并且是否和请求中的其他信息一致。如果Token验证失败，服务器就会拒绝请求，从而防止CSRF攻击的发生。
**为什么要放在header中**header中放入token在请求https的情况下保证了安全性，如果放入url参数中，别人就可以获取走你的token，从而有机会破解你的token令牌。
**为什么token要设置有效期**上面说到我们获取到token要进行持久化本地存储，也就是localStorage。因为localStorage能够被JS读取到，所以会存在安全隐患，应该设置一个过期时间。
### 
设置全局路由守卫，首先定义一个白名单，如果token不存在，同时不在白名单内，就会跳到登录页。token存在就会根据用户路由权限通过router.addRoute()方法动态添加路由。上面提到token是有有效期的，如果token过期了怎么办？这时我们可以选择在响应阻拦器拦截401状态码后让用户跳转到登录页重新登录。这种方法不利于用户体验，所以我们采用无感登录，响应阻拦器自动帮我们刷新token值。